# User-Agent Spoofing Vulnerability

## 1. Découverte de la faille

Lors de l’analyse de la page `redirect`, une requête spécifique a permis de révéler le flag :

```bash
curl -v -A "ft_bornToSec" "http://192.168.64.3/index.php?page=redirect&site=http://example.com"
```

L’option `-A` (ou `--user-agent`) permet de modifier l’en-tête HTTP `User-Agent`.

En réponse, le serveur a renvoyé :

```
Good Job Here is the flag : b9e775a0291fed784a2d9680fcfad7edd6b8cdf87648da647aaf4bba288bcab3
```

Cela montre que le serveur affiche le flag uniquement si le `User-Agent` correspond à une valeur spécifique — ici `ft_bornToSec`.

Ce comportement révèle une faille de type **User-Agent spoofing**, car le serveur base une logique de sécurité sur un en-tête HTTP facilement falsifiable.

---

## 2. Compréhension de la faille

Le `User-Agent` est un en-tête HTTP envoyé automatiquement par le navigateur pour identifier le client (par exemple : Chrome, Firefox, etc.). Cependant, cet en-tête :

- **n’est pas vérifié par le serveur**,
- **peut être modifié librement** par l’utilisateur.

Dans cette application, le code côté serveur contient probablement une condition du type :

```php
if ($_SERVER['HTTP_USER_AGENT'] == "ft_bornToSec") {
    echo "Good Job Here is the flag...";
}
```

Cette pratique est vulnérable, car toute personne capable de modifier son `User-Agent` (via `curl`, un proxy ou une extension navigateur) peut contourner la restriction et accéder au contenu.

Ce type de faille s’appelle **User-Agent Spoofing** — une sous-catégorie de **HTTP Header Spoofing**.

---

## 3. Preuve de concept (PoC)

### Requête vulnérable :
```bash
curl -v -A "ft_bornToSec" "http://192.168.64.3/index.php?page=redirect&site=http://example.com"
```

### Résultat :
```
Good Job Here is the flag : b9e775a0...
```

La simple falsification de l’en-tête `User-Agent` permet d’obtenir le flag.

---

## 4. Comment se protéger

### ❌ Mauvaise pratique :

Ne jamais baser une logique de sécurité ou un contrôle d’accès sur des en-têtes HTTP tels que :
- `User-Agent`
- `Referer`
- `X-Forwarded-For`

Ces valeurs peuvent être falsifiées très facilement.

### ✅ Bonnes pratiques :

- Utiliser une **authentification réelle** (sessions, tokens JWT, OAuth, etc.) pour la gestion des accès.
- Considérer les en-têtes HTTP comme **informatifs** uniquement (statistiques, logs, compatibilité, etc.).
- Implémenter une **vérification serveur** ou base de données pour les permissions sensibles.
- Ne jamais afficher de contenu critique selon un `User-Agent`, `Referer` ou toute autre donnée client non vérifiée.

---

## 5. Résumé

| Élément | Détail |
|----------|---------|
| **Type de faille** | User-Agent Spoofing (HTTP Header Spoofing) |
| **Impact** | Contournement d’une restriction d’accès et divulgation d’informations sensibles (flag) |
| **Cause** | Confiance dans un en-tête HTTP manipulable par le client |
| **Correction** | Supprimer la logique basée sur `User-Agent` et implémenter une authentification réelle |

---

**En résumé :** la faille vient du fait que le serveur prend une décision de sécurité basée sur un champ que le client contrôle totalement. Modifier le `User-Agent` a suffi à contourner la protection et obtenir le flag.

